import React , {Component }from 'react';
import { Text, View, Button , TouchableOpacity, ActivityIndicator, ScrollView,AsyncStorage } from 'react-native';
import Icons from 'react-native-vector-icons/MaterialIcons';

import BaseStyle from './BaseStyle.style';
import ReviewCard from './ReviewCard'

class Business extends Component {

  constructor(props){
    super(props);

    this.state = {
      isLoading:true,
      token:'',
      returnData:[],
      reviews:[
        { id : 1, overallRating:'5',priceRating:'4',qualityRating:'3',cleanlinessRating:'2', reviewBody: "review 1"},
        { id : 2, overallRating:'5',priceRating:'4',qualityRating:'3',cleanlinessRating:'2', reviewBody: "review 2"},
        { id : 3, overallRating:'5',priceRating:'4',qualityRating:'3',cleanlinessRating:'2', reviewBody: "review 3"},
        { id : 4, overallRating:'5',priceRating:'4',qualityRating:'3',cleanlinessRating:'2', reviewBody: "review 4"}
      ],
      newId:5
    }
  }

  componentDidMount(){
    this.getReviews();
  }

  getReviews(){
    return fetch('http://10.0.2.2:3333/api/1.0.0/location/1',{
      headers:{'Content-Type':'application/json'}
    })
    .then((response) => response.json())
    .then((responseJson) => {
      this.setState({
        returnData: responseJson
      })
      console.log(this.state.returnData.location_reviews[2].overall_rating)
      this.state.reviews.push({id:this.state.newId,overallRating:5,priceRating:'4',qualityRating:'3',cleanlinessRating:'2', reviewBody: "test test test"},)
      this.setState({isLoading:false})
    })
    .catch((error) => {
      console.log(error);
    });
  }

  pushReviews(){

  }




  render(){
    if(this.state.isLoading){
      return(
        <View style={BaseStyle.flexContainer}>
          <ActivityIndicator color='blue'/>
        </View>
      );
    }
    else{
    const navigation = this.props.navigation;
      return (
        <View style={BaseStyle.flexContainer}>
          <View style={BaseStyle.businessHeader}>
            <TouchableOpacity style={BaseStyle.backButton}
              onPress={() => navigation.goBack()}>

              <Icons name={'arrow-back'} size={30} color='white'/>
            </TouchableOpacity>
            <Text style={BaseStyle.businessTitleText}>Business Name</Text>
            <View style={BaseStyle.businessHeaderButton}>
              <Button
                title='Review'
                onPress={() => navigation.navigate('Review')}
              />
            </View>
          </View>
          <View style={BaseStyle.body}>
            <Button
              title={this.state.returnData.location_name}
              onPress={() => this.getReviews()}
            />
            <ScrollView style={BaseStyle.businessScrollView} >
              {this.state.reviews.map(review =>(
                <View key={review.id}>
                  <ReviewCard overallRating={review.overallRating} priceRating={review.priceRating} qualityRating={review.qualityRating} cleanlinessRating={review.cleanlinessRating} reviewBody={review.reviewBody}/>
                </View>
              ))}
            </ScrollView>
          </View>
        </View>

      );
    }
  }
}

export default Business;
